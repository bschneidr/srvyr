<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a tbl_svy survey object using two phase design — as_survey_twophase • srvyr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create a tbl_svy survey object using two phase design — as_survey_twophase" />
<meta property="og:description" content="Create a survey object by specifying the survey's two phase design. It is a
wrapper around twophase. All survey variables must be
included in the data.frame itself. Variables are selected by using bare
column names, or convenience functions described in
select." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
<img src="../tools/logo.png" height="50" width="50" align="left" display="block" style="margin: -15px 10px 0px 0px">
        <a class="navbar-link" href="../index.html">srvyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/srvyr-vs-survey.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/srvyr-vs-survey.html">srvyr Compared to the survey Package (Overview)</a>
    </li>
    <li>
      <a href="../articles/srvyr-database.html">Databases in srvyr</a>
    </li>
    <li>
      <a href="../articles/extending-srvyr.html">Extending srvyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/gergness/srvyr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a tbl_svy survey object using two phase design</h1>
    <small class="dont-index">Source: <a href='https://github.com/gergness/srvyr/blob/master/R/as_survey_twophase.r'><code>R/as_survey_twophase.r</code></a></small>
    <div class="hidden name"><code>as_survey_twophase.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a survey object by specifying the survey's two phase design. It is a
wrapper around <code><a href='https://rdrr.io/pkg/survey/man/twophase.html'>twophase</a></code>. All survey variables must be
included in the data.frame itself. Variables are selected by using bare
column names, or convenience functions described in
<code><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>as_survey_twophase</span><span class='op'>(</span><span class='va'>.data</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for data.frame</span>
<span class='fu'>as_survey_twophase</span><span class='op'>(</span>
  <span class='va'>.data</span>,
  <span class='va'>id</span>,
  strata <span class='op'>=</span> <span class='cn'>NULL</span>,
  probs <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  fpc <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>subset</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"full"</span>, <span class='st'>"approx"</span>, <span class='st'>"simple"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for twophase2</span>
<span class='fu'>as_survey_twophase</span><span class='op'>(</span><span class='va'>.data</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.data</th>
      <td><p>A data frame (which contains the variables specified below)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>ignored</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>list of two sets of variable names for sampling unit identifiers</p></td>
    </tr>
    <tr>
      <th>strata</th>
      <td><p>list of two sets of variable names (or <code>NULLs</code>) for stratum identifiers</p></td>
    </tr>
    <tr>
      <th>probs</th>
      <td><p>list of two sets of variable names (or <code>NULLs</code>) for sampling probabilities</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Only for method = "approx", list of two sets of variable names (or <code>NULLs</code>)
for sampling weights</p></td>
    </tr>
    <tr>
      <th>fpc</th>
      <td><p>list of two sets of variables (or <code>NULLs</code> for finite population corrections</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>bare name of a variable which specifies which observations are selected in phase 2</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>"full" requires (much) more memory, but gives unbiased variance estimates for
general multistage designs at both phases. "simple" or "approx" use less memory, and is correct for
designs with simple random sampling at phase one and stratified randoms sampling at phase two. See
<code><a href='https://rdrr.io/pkg/survey/man/twophase.html'>twophase</a></code> for more details.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>tbl_svy</code></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Examples from ?survey::twophase</span>
<span class='co'># two-phase simple random sampling.</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>pbc</span>, package<span class='op'>=</span><span class='st'>"survival"</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>

<span class='va'>pbc</span> <span class='op'>&lt;-</span> <span class='va'>pbc</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='group_trim.html'>mutate</a></span><span class='op'>(</span>randomized <span class='op'>=</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>trt</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>trt</span> <span class='op'>&gt;</span> <span class='fl'>0</span>,
         id <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>d2pbc</span> <span class='op'>&lt;-</span> <span class='va'>pbc</span> <span class='op'>%&gt;%</span>
  <span class='fu'>as_survey_twophase</span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>id</span><span class='op'>)</span>, subset <span class='op'>=</span> <span class='va'>randomized</span><span class='op'>)</span>

<span class='va'>d2pbc</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='summarise.html'>summarize</a></span><span class='op'>(</span>mean <span class='op'>=</span> <span class='fu'><a href='survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>bili</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 1 × 2</span>
#&gt;    mean mean_se
#&gt;   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span>  3.26   0.256</div><div class='input'>
<span class='co'># two-stage sampling as two-phase</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://r-survey.r-forge.r-project.org/survey/'>survey</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>mu284</span><span class='op'>)</span>

<span class='va'>mu284_1</span> <span class='op'>&lt;-</span> <span class='va'>mu284</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>15</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>, <span class='va'>n2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='group_trim.html'>mutate</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span>,
         sub <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='cn'>FALSE</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>15</span>, <span class='fl'>34</span><span class='op'>-</span><span class='fl'>15</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>dmu284</span> <span class='op'>&lt;-</span> <span class='va'>mu284</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>ids <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>id1</span>, <span class='va'>id2</span><span class='op'>)</span>, fpc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>n1</span>, <span class='va'>n2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># first phase cluster sample, second phase stratified within cluster</span>
<span class='va'>d2mu284</span> <span class='op'>&lt;-</span> <span class='va'>mu284_1</span> <span class='op'>%&gt;%</span>
  <span class='fu'>as_survey_twophase</span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>id1</span>, <span class='va'>id</span><span class='op'>)</span>, strata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='cn'>NULL</span>, <span class='va'>id1</span><span class='op'>)</span>,
                  fpc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>n1</span>, <span class='cn'>NULL</span><span class='op'>)</span>, subset <span class='op'>=</span> <span class='va'>sub</span><span class='op'>)</span>
<span class='va'>dmu284</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='summarise.html'>summarize</a></span><span class='op'>(</span>total <span class='op'>=</span> <span class='fu'><a href='survey_total.html'>survey_total</a></span><span class='op'>(</span><span class='va'>y1</span><span class='op'>)</span>,
            mean <span class='op'>=</span> <span class='fu'><a href='survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>y1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 1 × 4</span>
#&gt;   total total_se  mean mean_se
#&gt;   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>    <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span> <span style='text-decoration: underline;'>15</span>080    <span style='text-decoration: underline;'>2</span>274.  44.4    2.27</div><div class='input'><span class='va'>d2mu284</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='summarise.html'>summarize</a></span><span class='op'>(</span>total <span class='op'>=</span> <span class='fu'><a href='survey_total.html'>survey_total</a></span><span class='op'>(</span><span class='va'>y1</span><span class='op'>)</span>,
            mean <span class='op'>=</span> <span class='fu'><a href='survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>y1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 1 × 4</span>
#&gt;   total total_se  mean mean_se
#&gt;   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>    <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span> <span style='text-decoration: underline;'>15</span>080    <span style='text-decoration: underline;'>2</span>274.  44.4    2.27</div><div class='input'>
<span class='co'># dplyr 0.7 introduced new style of NSE called quosures</span>
<span class='co'># See `vignette("programming", package = "dplyr")` for details</span>
<span class='va'>ids</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rlang-tidyeval.html'>quo</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>d2pbc</span> <span class='op'>&lt;-</span> <span class='va'>pbc</span> <span class='op'>%&gt;%</span>
  <span class='fu'>as_survey_twophase</span><span class='op'>(</span>id <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='va'>ids</span>, subset <span class='op'>=</span> <span class='st'>"randomized"</span><span class='op'>)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Greg Freedman Ellis, Ben Schneider.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


